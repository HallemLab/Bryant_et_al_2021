---
title: "Neural Mechanisms of Parasite Thermosensation"
author: "Astra S. Bryant, PhD"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output:
  html_document:
    df_print: paged
    code_folding: hide
    toc: yes
    toc_depth: 3
    toc_float: TRUE
    number_sections: true
    fig_caption: TRUE
---


```{r setup, include=FALSE}
library(knitr)
library(rmarkdown)
library(tidyverse)
library(readxl)
library(magrittr)
library(DescTools)
library(ggthemes)
library(ggpubr)
library(rcartocolor)
library(Cairo)
library(gtools)
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction/Abstract
This purpose of this document is to collect, analyze, and plot data associated 
with the mansucript titled "Neural Mechanisms of Thermosensation in the Human 
Parasite *Strongyloides stercoralis*. 

# Study Design and Codebook

<!-- The data analyzed here belong to three different classes of experiments:  -->
<!-- population thermotaxis assays, thermotaxis tracking assays, and thermosensory  -->
<!-- calcium imaging experiments. In all cases, data is preprocessed using FIJI  -->
<!-- scripts and in some cases custom Matlab scripts. -->

<!-- ## 1. Population Thermotaxis Assays -->
<!-- `TT_population_data` is a tidverse data table containing metadata and results  -->
<!-- for thermotaxis population experiments. These data were preprocssed using FIJI. -->

<!-- #### Experiment Metadata -->

<!-- * UID - experiment unique ID -->
<!-- * setup_temps -->
<!-- + T~start~ - Temperature the worms are placed at -->
<!-- + T~C~ - Cultivation temperature of worms -->
<!-- + T~min~ - Gradient minimum temperature -->
<!-- + T~max~ - Gradietn maximum temperature -->

<!-- #### Experimental Conditions -->
<!-- Descriptions of the different types of experiments  -->
<!-- included in `TT_population_data` -->

<!-- * Negative Thermotaxis (12-22$^\circ$C Gradient) -->
<!-- * T~start~ = 14$^\circ$C, 17$^\circ$C, 20$^\circ$C -->
<!-- * T~C~ = 15$^\circ$C, 23$^\circ$C -->

<!-- #### Results Variables -->
<!-- These were generated by applying a 1$^\circ$C grid in FIJI and using the Cell  -->
<!-- Counter plugin to quantify the number of worms per  -->

<!-- + Temperature bin -->
<!-- + Number of Worms -->

<!-- ## 2. Thermotaxis Tracking Assays -->
<!-- `TT_worm_tracks` is a tidverse data table containing metadata and results for  -->
<!-- thermotaxis worm tracking assays. These data were preprocessed using FIJI and  -->
<!-- the TT_WormTracker Matlab codebase. -->

<!-- #### Track Metadata -->
<!-- These are the inputs to the Matlab Worm Tracking software. -->

<!-- * UID - worm unique ID -->
<!-- * cmperdeg -->
<!-- * setup_temps -->
<!-- + T~start~ - Temperature the worms are placed at -->
<!-- + T~C~ - Cultivation temperature of worms -->
<!-- + T~min~ - Gradient minimum temperature -->
<!-- + T~max~ - Gradietn maximum temperature -->

<!-- #### Experimental Conditions -->

<!-- * Positive Thermotaxis (22-34$^\circ$C Gradient) -->
<!-- * HisCl1 inactivation of *S. stercoralis*-AFD   -->
<!-- + BU Control -->
<!-- + 20-50 mM Histamine -->
<!-- * Negative Thermotaxis (12-22$^\circ$C Gradient) -->
<!-- * HisCl1 inactivation of *S. stercoralis*-AFD -->
<!-- + BU Control -->
<!-- + 20-50 mM Histamine -->
<!-- * *Ss-tax-4* CRISPR Mutants -->
<!-- + No-Cas9 control -->
<!-- + *Ss-tax-4* iL3s -->

<!-- #### Results Variables -->
<!-- These data were calculated by the TT_WormTracker Matlab code and are imported  -->
<!-- into RStudio from the results document generated by Matlab. -->

<!-- * Change in temperature ($^\circ$C) -->
<!-- * Worm speed (mm/s) -->
<!-- + Over entire track -->
<!-- + In specified temperature bin -->
<!-- * Distance ratio (total distance traveled/max displacement) -->

## Thermosensory Calcium Imaging
`TCI_data` is a tidyverse data table containing metadata and results for 
thermosensory calcium imaging experiments. These data were preprocessed 
using the TCI Matlab codebase.

<!-- #### Trace Metadata -->

<!-- * UID - recording unique ID -->
<!-- * Worm strain -->
<!-- * Thermal ramp delivered -->
<!-- * Thermal bins for correlation calculations -->
<!-- * Temperatures selected for calculating $\Delta$R/${R_0}$ response size -->

### Experimental Conditions


* Pseudo-fictive PT 20-34$^\circ$C ramp
* Pseudo-fictive PTe 20-40$^\circ$C ramp
* Pseudo-fictive PT15 12-26$^\circ$C ramp
* Pseudo-fictive PT15e 12-32$^\circ$C ramp
<!-- * Non-physiological PT 17-40$^\circ$C ramp -->
<!-- * Non-physiological NT 20-12$^\circ$C ramp -->

### Data
These data were preprocessed and calculated by TCI Matlab code and are 
imported into RStudio from the results document generated by Matlab.

* Spearman's correlation coefficient
* Thermal threshold (T*)
* Caclium response amplitude ($\Delta$R/${R_0}$) at T*

# AFD Response Properties
Thermosensory response properties of *C. elegans* AFD (strain = IK890), and *S. stercoralis* AFD (expression plasmid = pASB52).  

## Data Inputs
```{r echo=FALSE, message=FALSE}
dat_AFD_file <- c('~/Box Sync/Lab_Hallem/Astra/Writing/Bryant et al 20xx/Data/Calcium Imaging/AFDResponse_R_Import.xlsx')

if (is_empty(dat_AFD_file)){
  dat_AFD_file <- file.choose()
}
dat_AFD <- read_excel(dat_AFD_file, sheet = 1) %>%
  group_by(Species,Tc, Stimulus) %>%
  dplyr::mutate(Species = as_factor(Species)) %>%
  dplyr::mutate(Stimulus = as_factor(Stimulus)) %>%
  dplyr::mutate(Tc = as_factor(Tc))

dat_AFD_15 <- dplyr::filter(dat_AFD, Tc == 15)
dat_AFD_23 <- dplyr::filter(dat_AFD, Tc == 23)

```

## AFD Plot Templates  

```{r AFD_Plot_Templates}
source("theme_Publication.R")
plot_AFD <- function(dat, y, ylim, xlabel, ylabel, stat.test, stat.y.position, title = NULL){
  ggplot(data = dat, mapping = aes(x = Species, y = y)) + 
    stat_boxplot(geom = "errorbar", 
                 width = 0.25,
                 size = .5) +
    geom_boxplot(width = 0.5,
                 outlier.shape = NA,
                 fatten = 1,
                 key_glyph = "rect",
                alpha = 0.3,
                 show.legend = F,
                 aes(fill = Species)) +
    geom_jitter(size = 1,
                stroke = .75,
                width = .2,
                aes(color = Species, shape = Stimulus)) +
     stat_pvalue_manual(stat.test, 
                        y.position = stat.y.position, 
                        label = 'p.signif') + 
    scale_y_continuous(limits = ylim, 
                       expand = expansion(add = 0)) +
    scale_color_carto_d(palette = "Vivid") +
    scale_fill_carto_d(palette = "Vivid") +
    scale_shape_manual(values = c(21:23))  +
    xlab(xlabel) +
    ylab(ylabel) +
    ggtitle(title) +
    theme_Publication() +
    theme(aspect.ratio = 2/1) 
}

plot_AFD_Speciesfacet <- function(dat, y, ylim, xlabel, ylabel, stat.test, stat.y.position, title = NULL){
  ggplot(data = dat, mapping = aes(x = Tc, y = y)) + 
    stat_boxplot(geom = "errorbar", 
                 width = 0.25,
                 size = .5) +
    geom_boxplot(width = 0.5,
                 outlier.shape = NA,
                 fatten = 1,
                 key_glyph = "rect",
                 #alpha = 0.3,
                 show.legend = F,
                 aes(fill = Species)) +
    geom_jitter(size = 2,
                stroke = .75,
                width = .2,
                aes(color = Species, shape = Stimulus)) +
     stat_pvalue_manual(stat.test, 
                        y.position = stat.y.position, 
                        label = 'p.signif') + 
    facet_grid(. ~ Species)+
    scale_y_continuous(limits = ylim, 
                       expand = expansion(add = 0)) +
    scale_color_carto_d(palette = "Vivid") +
    scale_fill_carto_d(palette = "Vivid") +
    scale_shape_manual(values = c(21:23))  +
    xlab(xlabel) +
    ylab(ylabel) +
    ggtitle(title) +
     theme_Publication() +
    theme(aspect.ratio = 2/1) 
}

plot_AFD_Tcfacet <- function(dat, y, ylim, xlabel, ylabel, stat.test, stat.y.position, title = NULL){
  ggplot(data = dat, mapping = aes(x = Species, y = y)) + 
    stat_boxplot(geom = "errorbar", 
                 width = 0.25,
                 size = .5) +
    geom_boxplot(width = 0.5,
                 outlier.shape = NA,
                 fatten = 1,
                 key_glyph = "rect",
                 #alpha = 0.3,
                 show.legend = F,
                 aes(fill = Species)) +
    geom_jitter(size = 2,
                size = .75,
                width = .2,
                aes(color = Species, shape = Stimulus)) +
     stat_pvalue_manual(stat.test, 
                        y.position = stat.y.position, 
                        label = 'p.signif') + 
    facet_grid(. ~ Tc)+
    scale_y_continuous(limits = ylim, 
                       expand = expansion(add = 0)) +
    scale_color_carto_d(palette = "Vivid") +
    scale_fill_carto_d(palette = "Vivid") +
    scale_shape_manual(values = c(21:23))  +
    xlab(xlabel) +
    ylab(ylabel) +
    ggtitle(title) +
    theme_Publication() +
    theme(aspect.ratio = 2/1) 
}

```

## Temperature Threshold  

Statistics are  Wilcoxon signed-rank tests.  

### Tc = 23C  

``` {r, message=FALSE}
xlabel <- "Species"
ylabel <- " Temperature (C)"
title <- "Threshold Temperature, Tc = 23C"
ylim <- c(10, 41)

stat.thresh.23 <- compare_means(Temperature ~ Species, 
                           data = dat_AFD_23,
                           p.adjust.method = "bonferroni")

p.thresh.23 <- plot_AFD(dat_AFD_23, 
         dat_AFD_23$Temperature, 
         ylim,
         xlabel, 
         ylabel,
         stat.thresh.23,
         32,
         title)

print(p.thresh.23)
```

### Tc = 15C  

``` {r, message=FALSE}
xlabel <- "Species"
ylabel <- " Temperature (C)"
title <- "Threshold Temperature, Tc = 15C"
ylim <- c(10, 41)

stat.thresh.15 <- compare_means(Temperature ~ Species, 
                           data = dat_AFD_15,
                           p.adjust.method = "bonferroni")

p.thresh.15 <- plot_AFD(dat_AFD_15, 
         dat_AFD_15$Temperature, 
         ylim,
         xlabel, 
         ylabel,
         stat.thresh.15,
         32,
         title)

print(p.thresh.15)
```

## Calcium Response at T*  

Statistics are  Wilcoxon signed-rank tests. 

### Tc = 23C  

```{r, message=FALSE}
ylabel <- "% dR/R0"
title <- "Calcium Response at T*, Tc = 23C"
ylim <- c(-25, 25)

stat.threshresp.23 <- compare_means(CaResponse ~ Species, 
                           data = dat_AFD_23)

p.threshresp.23 <- plot_AFD(dat_AFD_23, 
         dat_AFD_23$CaResponse, 
         ylim,
         xlabel, 
         ylabel,
         stat.threshresp.23,
         19,
         title)

print(p.threshresp.23)
```

### Tc = 15C  

```{r, message=FALSE}
ylabel <- "% dR/R0"
title <- "Calcium Response at T*, Tc = 15C"
ylim <- c(-25, 25)

stat.threshresp.15 <- compare_means(CaResponse ~ Species, 
                           data = dat_AFD_15)

p.threshresp.15 <- plot_AFD(dat_AFD_15, 
         dat_AFD_15$CaResponse, 
         ylim,
         xlabel, 
         ylabel,
         stat.threshresp.15,
         19,
         title)

print(p.threshresp.15)
```

### Bar Graph
```{r}

xlabel <- "Species"
ylabel <- "Proportion of Wroms"
title <- "Direction of Ca Response at T*"

dat_bar <- dat_AFD %>%
  dplyr::mutate(Type = as_factor(case_when(
    CaResponse > 0 ~ "Positive",
    CaResponse < 0 ~ "Negative"))) %>%
  dplyr::mutate(Type = relevel(Type, "Negative")) %>%
  dplyr::mutate(Tc = relevel(Tc, "23")) %>%
  dplyr::group_by(Tc, Species, Type) 


  p.bar <- ggplot(data = dat_bar, mapping = aes(x = Species)) + 
    geom_bar(aes(fill = Type), position = "fill") +
    scale_color_carto_d(palette = "Safe") +
    scale_fill_carto_d(palette = "Safe") +
    facet_wrap(~Tc)+
    xlab(xlabel) +
    ylab(ylabel) +
    ggtitle(title) +
    theme_Publication() +
    theme(aspect.ratio = 2/1) 
```


## Spearman Correlation  

Statistics are  Wilcoxon signed-rank tests.  

### Tc = 23C  

```{r, message=FALSE}

ylabel <- "Spearman's Correlation"
title <- "T vs Ca Correlation, Tc = 23C"
ylim <- c(-1.5, 1.5)
stat.spearman.23 <- compare_means(AboveThSpearmanR ~ Species, 
                           data = dat_AFD_23)

p.spearman.23 <- plot_AFD(dat_AFD_23, 
         dat_AFD_23$AboveThSpearmanR, 
         ylim,
         xlabel, 
         ylabel,
         stat.spearman.23,
         1.3,
         title)

print(p.spearman.23)
```

### Tc = 15C  

```{r, message=FALSE}

ylabel <- "Spearman's Correlation"
title <- "T vs Ca Correlation, Tc = 15C"
ylim <- c(-1.5, 1.5)
stat.spearman.15 <- compare_means(AboveThSpearmanR ~ Species, 
                           data = dat_AFD_15)

p.spearman.15 <- plot_AFD(dat_AFD_15, 
         dat_AFD_15$AboveThSpearmanR, 
         ylim,
         xlabel, 
         ylabel,
         stat.spearman.15,
         1.3,
         title)

print(p.spearman.15)
```

## Group and Save AFD Plots
```{r}
ggarrange(
  p.thresh.23,
  p.thresh.15,
  p.threshresp.23,
  p.threshresp.15,
  p.spearman.23,
  p.spearman.15, 
  p.bar,
  ncol = 2,
  nrow = 4
) %>%
ggsave(filename ="AFD_Plots.pdf",
       device = cairo_pdf,
       width = 7,
       height = 9.5,
       path = dirname(dat_AFD_file))
```

# Ss-AFD-rGC Ecoptic Expression Analysis
Analysis and plotting for a series of experiments testing the effect of 
ectopic expression of *Strongyloides stercoralis* AFD rGCs in *C. elegans* 
ASE neurons.

## Data Inputs
Data are preprocessed using Matlab TCI file `TCI_analyzeEctopic.m`, which calculates the temperature at which point an experimental trace rises above 3*rms of mean control trace for at least 6 seconds. 
This calculation is run independently for each trace, and the value (in degrees C)
is saved.

```{r echo=FALSE, message=FALSE}
dat_ectopic_file <- c('~/Box Sync/Lab_Hallem/Astra/Writing/Bryant et al 20xx/Data/Calcium Imaging/Ectopic Expression/EctopicExpression_R_Import.xlsx')
#dat_file <- NULL
if (is_empty(dat_ectopic_file)){
  dat_ectopic_file <- file.choose()
}
meta_ectopic <-read_excel(dat_ectopic_file, sheet = "Metadata")
dat_ectopic <- read_excel(dat_ectopic_file, sheet = 1) %>%
  group_by(rGC,Strain)


dat_ectopic_filtered <- dat_ectopic %>%
  dplyr::filter(rGC != "ASE_ctrl") %>%
  dplyr::filter(!is.na(Thresh_temp)) %>%
  dplyr::bind_rows(dplyr::filter(dat_ectopic, rGC == "ASE_ctrl"))
```

## rGC Plot Templates 

```{r}
source("theme_Publication.R")

plot_ectopic_noctrl <- function(dat, y, meta, ylim, xlabel,
                                ylabel, stat.test, 
                                stat.y.position,
                                title = NULL){
  ggplot(data = dat, mapping = aes(x = rGC, y = y)) + 
    
    stat_boxplot(geom = "errorbar", 
                 width = 0.25,
                 size = 0.5) +
    geom_boxplot(width = 0.5,
                 outlier.shape = NA,
                 fatten = 1,
                 key_glyph = "rect",
                 alpha = 0.3,
                 aes(fill = rGC)) +
    geom_jitter(size = 2,
                stroke = .75,
                width = .2,
                aes(color = Strain, shape = Strain)) +
    stat_pvalue_manual(stat.test, 
                        y.position = stat.y.position,
                       step.increase = 0.1,
                       tip.length = 0,
                       hide.ns = TRUE,
                       bracket.shorten = 0.2,
                       label = "p.adj.signif"
                       ) + 
    scale_y_continuous(limits = ylim, 
                       expand = expansion(add = 0)) +
    xlab(xlabel) +
    ylab(ylabel) +
    ggtitle(title) +
    scale_fill_manual(values = c("darkorchid4", "cyan4", "coral4"))+
    #scale_color_carto_d(palette = "Bold") +
    scale_color_manual(values = c(rep(c("darkorchid4","cyan4", "coral4"),each = 3)))+
    scale_shape_manual(values = rep(c(21:23), 3))  +
    theme_Publication() +
    theme(aspect.ratio = 4/3,
          axis.text.x = element_text(angle= 45,
                                     
                                     hjust = 1)) 
}
```


## Temperature Threshold  
Stats are Kruskal-Wallis Test with Dunn's Post tests for difference in response amplitude.  

``` {r}
# ---- Temperature Threshold Plot ----

xlabel <- "Ss-AFD-rGCs"
ylabel <- " Temperature (C)"
title <- "Threshold Temperature"
ylim <- c(19, 45)

dat.subset <-dplyr::filter(dat_ectopic_filtered, rGC != "ASE_ctrl")%>%
  dplyr::mutate(Strain = as_factor(Strain)) %>%
  dplyr::mutate(rGC = as_factor(rGC))

# Kruskal-Wallis testing of response amplitude differenec
one.way <- kruskal.test(Thresh_temp ~ rGC, 
                        data = dat.subset)

# Posthoc Dunn tests with Bonferroni adjustment
post.hoc <- dunn.test::dunn.test(dat.subset$Thresh_temp, 
                                 dat.subset$rGC, 
                                 method = "bonferroni",
                                 table = FALSE,
                                 list = TRUE)

stat.test.ectopic.thresh <- dplyr::tibble(
  comparisons = post.hoc$comparisons,
  p.adj = post.hoc$P.adjusted,
  p.adj.signif = stars.pval(post.hoc$P.adjusted)
) %>%
  mutate(p.adj.signif = case_when(p.adj.signif == " " ~ "ns",
                                  TRUE ~ as.character(p.adj.signif))) %>%
  tidyr::separate(comparisons, 
                  into = c("group1", "group2"),
                  sep = " - ")

p_ectopic_thresh<- plot_ectopic_noctrl(dat.subset, 
                                       dat.subset$Thresh_temp, 
                                       meta_ectopic,
                                       ylim,
                                       xlabel, 
                                       ylabel,
                                       stat.test.ectopic.thresh,
                                       41,
                                       title)


print(p_ectopic_thresh)


```



## Temperature driving maximum response  

Stats are Kruskal-Wallis Test with Dunn's Post tests for difference in response amplitude.  
```{r}
# Kruskal-Wallis testing of response amplitude differenec
one.way <- kruskal.test(Tmax ~ rGC, 
                        data = dat.subset)

# Posthoc Dunn tests with Bonferroni adjustment
post.hoc <- dunn.test::dunn.test(dat.subset$Tmax, 
                                 dat.subset$rGC, 
                                 method = "bonferroni",
                                 table = FALSE,
                                 list = TRUE)

xlabel <- "Ss-AFD-rGCs"
ylabel <- "Temperature (deg C)"
title <- "Temperature driving max calcium response"
ylim <- c(19,45)

stat.test.ectopic.Tmax <- dplyr::tibble(
  comparisons = post.hoc$comparisons,
  p.adj = post.hoc$P.adjusted,
  p.adj.signif = stars.pval(post.hoc$P.adjusted)
) %>%
  mutate(p.adj.signif = case_when(p.adj.signif == " " ~ "ns",
                                  TRUE ~ as.character(p.adj.signif))) %>%
  tidyr::separate(comparisons, 
                  into = c("group1", "group2"),
                  sep = " - ")

p_Tmax<- plot_ectopic_noctrl(dat.subset, 
                             dat.subset$Tmax, 
                             meta_ectopic,
                             ylim,
                             xlabel, 
                             ylabel,
                             stat.test.ectopic.Tmax,
                             42,
                             title)

# ggsave("Ss-AFD-rGCsTmax.eps",
#        plot = p_Tmax,
#        device = "eps",
#        width = 3.5,
#        path = dirname(dat_ectopic_file))

print(p_Tmax)
```



## Group and Save Ectopic Plots
```{r}
ggarrange(
  p_ectopic_thresh,
  p_Tmax, 
  ncol = 2,
  nrow = 1
) %>%
ggsave(filename ="rGC_Plots.pdf",
       device = cairo_pdf,
       width = 7,
       # height = 3.5,
       path = dirname(dat_AFD_file))
```


```{r}
plot_ectopic <- function(dat, y, meta, ylim, xlabel, ylabel, title = NULL){
  ggplot(data = dat, mapping = aes(x = rGC, y = y)) + 
    # stat_boxplot(geom = "errorbar", width = 0.4) +
    # geom_boxplot(width = 0.6, 
    #              outlier.shape = NA, 
    #              fatten = 1.5, 
    #              key_glyph = "rect",
    #              alpha = 0.7,
    #              aes(fill = rGC)) +
    geom_violin(#alpha = 0.5,
      aes(fill = rGC)) +
    geom_jitter(size = 2,
                stroke = .75,
                width = .2,
                aes(color = Strain, shape = Strain)) +
    stat_summary(fun.data = "median_hilow", 
                 size = .2,
                 geom = "pointrange",
                 fun.args = list(conf.int = .5)) + 
    scale_y_continuous(limits = ylim, 
                       expand = expansion(add = 0)) +
    xlab(xlabel) +
    ylab(ylabel) +
    ggtitle(title) +
    #scale_color_manual(values = c("black","darkorchid4", "cyan4", "coral4"))+
    scale_fill_manual(values = c("black","darkorchid4", "cyan4", "coral4"))+
    scale_color_manual(values = c(rep(c("darkorchid4", "cyan4", "coral4"),each = 3),"grey")) +
    #scale_shape_manual(values = rep(c(21:23), 3))  +
    scale_shape_manual(values = c(21:23, 21:23, 21:23, 24))  +
    theme_Publication() +
    theme(aspect.ratio = 4/3) 
}
```

## Response size at 24C
```{r}
xlabel <- "Ss-AFD-rGCs"
ylabel <- "Response Amplitude (% dR/R)"
title <- "Calcium Response at 24C"
ylim <- c(-20,150)
p_24C<- plot_ectopic(dat_ectopic_filtered, 
                     dat_ectopic_filtered$ResponseSize_24C, 
                     meta_ectopic,
                     ylim,
                     xlabel, 
                     ylabel,
                     title) 

# ggsave("Ss-AFD-rGCs_Response_24C.eps", 
#        plot = p_24C, 
#        device = "eps",
#        width = 3.5,
#        # height = 3.5,
#        path = dirname(dat_ectopic_file))

print(p_24C)


```

### Kruskal-Wallis Test with Dunn's Post tests for difference in response amplitude  
```{r}
# Kruskal-Wallis testing of response amplitude differenec
one.way <- kruskal.test(ResponseSize_24C ~ rGC, 
                        data = dat_ectopic_filtered)

# Posthoc Dunn tests with Bonferroni adjustment
post.hoc <- dunn.test::dunn.test(dat_ectopic_filtered$ResponseSize_24C, 
                                 dat_ectopic_filtered$rGC, 
                                 method = "bonferroni",
                                 table = FALSE,
                                 list = TRUE)
```

## Response size at 33C
```{r}
xlabel <- "Ss-AFD-rGCs"
ylabel <- "Response Amplitude (% dR/R)"
title <- "Calcium Response at 33C"
ylim <- c(-20,150)
p_33C<- plot_ectopic(dat_ectopic_filtered, 
                     dat_ectopic_filtered$ResponseSize_33C, 
                     meta_ectopic,
                     ylim,
                     xlabel, 
                     ylabel,
                     title)

# ggsave("Ss-AFD-rGCs_Response_33C.eps", 
#        plot = p_33C, 
#        device = "eps",
#        width = 3.5,
#        # height = 3.5,
#        path = dirname(dat_ectopic_file))

print(p_33C)
```

### Kruskal-Wallis Test with Dunn's Post tests for difference in response amplitude  
```{r}
# Kruskal-Wallis testing of response amplitude differenec
one.way <- kruskal.test(ResponseSize_33C ~ rGC, 
                        data = dat_ectopic_filtered)

# Posthoc Dunn tests with Bonferroni adjustment
post.hoc <- dunn.test::dunn.test(dat_ectopic_filtered$ResponseSize_33C, 
                                 dat_ectopic_filtered$rGC, 
                                 method = "bonferroni",
                                 table = FALSE,
                                 list = TRUE)
```

## Response size at Max Temperature
```{r}
xlabel <- "Ss-AFD-rGCs"
ylabel <- "Response Amplitude (% dR/R)"
title <- "Calcium Response at 40C"
ylim <- c(-20,150)
p_tmax<- plot_ectopic(dat_ectopic_filtered, 
                      dat_ectopic_filtered$ResponseSize_40C, 
                      meta_ectopic,
                      ylim,
                      xlabel, 
                      ylabel,
                      title)

# ggsave("Ss-AFD-rGCs_Response_MaxTemp.eps", 
#        plot = p_tmax, 
#        device = "eps",
#        width = 3.5,
#        # height = 3.5,
#        path = dirname(dat_ectopic_file))
print(p_tmax)
```

### Kruskal-Wallis Test with Dunn's Post tests for difference in response amplitude  
```{r}
# Kruskal-Wallis testing of response amplitude differenec
one.way <- kruskal.test(ResponseSize_40C ~ rGC, 
                        data = dat_ectopic_filtered)

# Posthoc Dunn tests with Bonferroni adjustment
post.hoc <- dunn.test::dunn.test(dat_ectopic_filtered$ResponseSize_40C, 
                                 dat_ectopic_filtered$rGC, 
                                 method = "bonferroni",
                                 table = FALSE,
                                 list = TRUE)
```